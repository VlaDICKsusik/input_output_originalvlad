# Ввод/вывод vs Обработка данных




Ключевой критерий качества кода — это стоимость внесения в него изменений. 	Ключевой критерий качества кода — это стоимость внесения в него изменений. 
@@ -7,15 +7,22 @@
безгранично гибкий код — это как сферический конь в вакууме. Теоретически 	безгранично гибкий код — это как сферический конь в вакууме. Теоретически 
возможен, но практической ценности не несет.	возможен, но практической ценности не несет.


Если мы заранее будем знать как изменятся требования к коду через год, два или 
десять лет, то уже сейчас можно заложить необходимые механизмы расширения 
функциональности. К сожалению, такие сведения сложно получить, а зачастую 
просто невозможно. Приходится опираться на свой опыт, опыт товарищей, 
прорабатывать разные сценарии развития проекта, подстраховываться.

Один из часто встречающихся и оправданных приемов — это отделение обработки 	Один из часто встречающихся и оправданных приемов — это отделение обработки 
данных от процесса ввода/вывода. Рассмотрим несколько примеров.	данных от процесса ввода/вывода. Рассмотрим несколько примеров.


Пример. Подбор онлайн-курса	## Пример. Подбор онлайн-курса




По условию задачи нужно скачать из сети данные об онлайн-курсах, выбрать из 	По условию задачи нужно скачать из сети данные об онлайн-курсах, выбрать из 
них лучшие и сохранить результат в xlsx файл. Вот фрагмент кода:	них лучшие и сохранить результат в xlsx файл. Вот фрагмент кода:


```python
def get_courses_list(courses_url):	def get_courses_list(courses_url):
    html = fetch_html(courses_url)	    html = fetch_html(courses_url)
    if html:	    if html:
@@ -24,6 +31,7 @@ def get_courses_list(courses_url):
    else:	    else:
        print("can't load list of courses")	        print("can't load list of courses")
        exit()	        exit()
```
Теперь примерим на себя роль провидца и подумаем какой функционал потребуется 	Теперь примерим на себя роль провидца и подумаем какой функционал потребуется 
через месяц:	через месяц:


@@ -32,26 +40,27 @@ def get_courses_list(courses_url):
В случае если адрес недоступен - постучаться по другому url в зеркало сайта.	В случае если адрес недоступен - постучаться по другому url в зеркало сайта.
В случае ошибки сделать запись в лог и взять данные из ранее подготовленного 	В случае ошибки сделать запись в лог и взять данные из ранее подготовленного 
кеша.	кеша.
Как все это сделать когда def get_courses_list сама завершает программу ?! От 	Как все это сделать когда ```def get_courses_list``` сама завершает программу ?! От 
вызова exit() надо отказаться. Можно выбросить исключение и таким образом 	вызова ```exit()``` надо отказаться. Можно выбросить исключение и таким образом 
сообщить о проблеме внешнему коду, пускай там разбираются.	сообщить о проблеме внешнему коду, пускай там разбираются.


Вызов print тоже стоит вынести из тела функции наружу. В рассмотренных 	Вызов ```print``` тоже стоит вынести из тела функции наружу. В рассмотренных 
сценариях вывод в консоль зависит от общей логики загрузки данных и 	сценариях вывод в консоль зависит от общей логики загрузки данных и 
многократных вызовов def get_courses_list.	многократных вызовов ```def get_courses_list```.


Что еще может потребоваться в скором будущем?	Что еще может потребоваться в скором будущем?


Отладить и покрыть тестами парсер HTML страницы.	Отладить и покрыть тестами парсер HTML страницы.
Ускорить работу скрипта, хранить ранее скачанные страницы в кеше на жестком 	Ускорить работу скрипта, хранить ранее скачанные страницы в кеше на жестком 
диске.	диске.
Ага, значит вызывать fetch_html() внутри def get_courses_list не такая уж 	Ага, значит вызывать ```fetch_html()``` внутри ```def get_courses_list``` не такая уж 
хорошая идея. Жить будет легче если передать в def get_courses_list строку с 	хорошая идея. Жить будет легче если передать в ```def get_courses_list``` строку с 
HTML разметкой вместо courses_url. Вуаля, мы решили проблемы еще до их 	HTML разметкой вместо ```courses_url```. Вуаля, мы решили проблемы еще до их 
появления на горизонте!	появления на горизонте!


Пойдем дальше. Код другой функции:	Пойдем дальше. Код другой функции:


```python
def get_course_info(html):	def get_course_info(html):
    # ...  parsing logic	    # ...  parsing logic


@@ -65,18 +74,20 @@ def get_course_info(html):
    # .... parsing logic	    # .... parsing logic


    return course_data	    return course_data
```
Что может произойти с кодом дальше?	Что может произойти с кодом дальше?


Если рейтинга нет — надо искать его на другом сайте.	Если рейтинга нет — надо искать его на другом сайте.
В xlsx указывать не просто отсутствие рейтинга, а еще на каких сайтах искал.	В xlsx указывать не просто отсутствие рейтинга, а еще на каких сайтах искал.
Отчет о курсах без рейтинга выгружать в дополнительную вкладку xlsx, чтобы 	Отчет о курсах без рейтинга выгружать в дополнительную вкладку xlsx, чтобы 
удобнее было руками проверять.	удобнее было руками проверять.
Для всего этого нужно уметь отличать от прочих ситуацию "рейтинг неизвестен". 	Для всего этого нужно уметь отличать от прочих ситуацию "рейтинг неизвестен". 
В Python для этих целей предусмотрено значение rating = None. А строку "No 	В Python для этих целей предусмотрено значение ```rating = None```. А строку "No 
rating yet" можно переместить туда где данные подготавливаются к выводу в xlsx.	rating yet" можно переместить туда где данные подготавливаются к выводу в xlsx.


Та же функция, часть вторая, последняя:	Та же функция, часть вторая, последняя:


```python
def get_course_info(html):	def get_course_info(html):
    # ... more parsing logic is here	    # ... more parsing logic is here


@@ -88,23 +99,33 @@ def get_course_info(html):
        '4_weeks': duration,	        '4_weeks': duration,
        "5_rating": rating	        "5_rating": rating
    }	    }
```
Сразу возникают вопросы. А если нужна еще одна выгрузка в формате csv, с 	Сразу возникают вопросы. А если нужна еще одна выгрузка в формате csv, с 
другим порядком столбцов, как это сделать? Как заменить столбец 2_date на 	другим порядком столбцов, как это сделать? Как заменить столбец ```2_date``` на 
days_before_start ?	```days_before_start``` ?


Кроме того, наперед известно, что пользовательский интерфейс — будь то вывод в 	Кроме того, наперед известно, что пользовательский интерфейс — будь то вывод в 
консоль или запись в файл — меняется очень часто. Было бы удобно собрать все, 	консоль или запись в файл — меняется очень часто. Было бы удобно собрать все, 
что относится к форматированию вывода в одном месте. Например, всю логику 	что относится к форматированию вывода в одном месте. Например, всю логику 
выгрузки в xlsx поместить в def fill_xlsx(workbook, courses):, а вывод в 	выгрузки в xlsx поместить в ```def fill_xlsx(workbook, courses):```, а вывод в 
консоль собрать внутри if __name__=='__main__':. Удастся избежать вычитывания 	консоль собрать внутри ```if __name__=='__main__':```. Удастся избежать вычитывания 
и повторной отладки всей программы от начала до конца, ведь изменения локальны 	и повторной отладки всей программы от начала до конца, ведь изменения локальны 
и изолированы.	и изолированы.


Вместо заключения	## Вместо заключения




В результате мы пришли к ситуации, когда логика обработки данных слабо зависит:	В результате мы пришли к ситуации, когда логика обработки данных слабо зависит:


1)от источника данных;	1)от источника данных;

2)от формата вывода в файл.	2)от формата вывода в файл.


Кроме того, часть кода удалось превратить в [чистые функции](https://devman.org/encyclopedia/decomposition/decomposition_pure_functions/), что облегчит 
тестирование и повторное использование.

Стратегия по отделению операций ввода/вывода от обработки данных встречается 
повсеместно, в самых разных программах: от небольших скриптов до серьезных и 
крупных проектов. Это один из базовых приемов, нужно уверенно им владеть.

![image](https://dvmn.org/filer/canonical/1594117412/678/)
